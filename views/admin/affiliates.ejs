<%- include("../partials/head", { title }) %>
<main class="landing">
  <%- include("../partials/admin-nav") %>
  <section class="how">
    <%- include("../partials/flash") %>
    <section class="card">
      <h1>Afiliados</h1>
      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>Nombre</th><th>Email</th><th>Ref code</th><th>Referidos</th><th>Ganado</th><th>Pagado</th><th>Estado</th><th>Acciones</th></tr></thead>
          <tbody>
            <% affiliates.forEach((a) => { %>
              <tr>
                <td><a class="link" href="/admin/affiliate/<%= a.id %>"><%= a.full_name %></a></td>
                <td><%= a.email %></td>
                <td><code><%= a.ref_code %></code></td>
                <td><%= a.referrals_count %></td>
                <td>$<%= Number(a.total_commission_earned || 0).toLocaleString("es-AR") %></td>
                <td>$<%= Number(a.total_commission_paid || 0).toLocaleString("es-AR") %></td>
                <td><span class="tag <%= a.is_active ? 'tag-ok' : 'tag-warn' %>"><%= a.is_active ? 'Activo' : 'Inactivo' %></span></td>
                <td>
                  <form method="post" action="/admin/affiliates/<%= a.id %>/toggle-active">
                    <button class="btn btn-ghost" type="submit"><%= a.is_active ? 'Desactivar' : 'Activar' %></button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </section>
  </section>
</main>
<%- include("../partials/scripts") %>
