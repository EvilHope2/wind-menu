<%- include("../partials/head", { title }) %>
<% if (currentUser.role === 'COMMERCE') { %>
  <main class="app-shell">
    <%- include("../partials/app-sidebar", { activePage }) %>
    <section class="app-content">
      <%- include("../partials/flash") %>
      <header class="page-head">
        <div>
          <h1>Consentimiento legal</h1>
          <p class="muted">Versiones aceptadas y fecha de registro.</p>
        </div>
        <a class="btn btn-ghost" href="/legal/accept">Actualizar aceptacion</a>
      </header>
      <section class="card">
        <h2>Version vigente</h2>
        <p>Terminos: <strong><%= legal.terms.version %></strong> | Privacidad: <strong><%= legal.privacy.version %></strong></p>
        <p class="muted">TyC vigencia: <%= legal.terms.effective_date %> | Privacidad vigencia: <%= legal.privacy.effective_date %></p>
      </section>
      <section class="card">
        <h2>Tu historial</h2>
        <% if (!consents.length) { %><p class="empty">Todavia no registras aceptaciones.</p><% } else { %>
          <div class="table-wrap">
            <table class="table">
              <thead><tr><th>Fecha</th><th>Rol</th><th>Terminos</th><th>Privacidad</th><th>Origen</th></tr></thead>
              <tbody>
                <% consents.forEach((row) => { %><tr><td><%= row.accepted_at %></td><td><%= row.role %></td><td><%= row.terms_version %></td><td><%= row.privacy_version %></td><td><%= row.source || '-' %></td></tr><% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </section>
    </section>
  </main>
<% } else { %>
  <main class="landing">
    <% if (currentUser.role === 'AFFILIATE') { %><%- include("../partials/affiliate-nav") %><% } else { %><%- include("../partials/admin-nav") %><% } %>
    <section class="how">
      <%- include("../partials/flash") %>
      <section class="card">
        <h1>Consentimiento legal</h1>
        <p class="muted">Terminos: <strong><%= legal.terms.version %></strong> | Privacidad: <strong><%= legal.privacy.version %></strong></p>
        <a class="btn btn-ghost" href="/legal/accept">Actualizar aceptacion</a>
      </section>
      <section class="card">
        <h2>Tu historial</h2>
        <% if (!consents.length) { %><p class="empty">Todavia no registras aceptaciones.</p><% } else { %>
          <div class="table-wrap">
            <table class="table">
              <thead><tr><th>Fecha</th><th>Rol</th><th>Terminos</th><th>Privacidad</th><th>Origen</th></tr></thead>
              <tbody>
                <% consents.forEach((row) => { %><tr><td><%= row.accepted_at %></td><td><%= row.role %></td><td><%= row.terms_version %></td><td><%= row.privacy_version %></td><td><%= row.source || '-' %></td></tr><% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </section>
    </section>
  </main>
<% } %>
<%- include("../partials/scripts") %>
